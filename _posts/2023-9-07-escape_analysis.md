---
title: 栈逃逸分析初步
author: Alex
date: 2023-9-04
category: tech
layout: post
--- 

函数调用中，局部变量会储存在调用栈中。但有时候，局部变量从栈逃逸至堆中。

本篇文章中，我们将讨论栈逃逸的原因和各种可能情况，并介绍一种简单但巧妙地分析算法，并尝试用[rust](https://www.rust-lang.org/)实现这种算法以用于[pivot lang](https://lang.pivotstudio.cn/)

## 1 堆与栈

堆(heap)是一种动态分配内存的方式，它的内存位置是离散的，大小不定，需要通过GC进行回收。而栈(stack)是一种静态分配内存的方式，它的内存位置是连续的，大小固定。

(btw,中文中喜欢把stack称为堆栈，很令人困惑。本文中，我们使用stack称呼栈。)

因此，我们很容易看出：如果可以的话，在函数调用中，我们应该尽量使用栈而不是堆，因为栈的内存分配速度更快，而且不需要GC。

